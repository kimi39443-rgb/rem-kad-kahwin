<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Jemputan Digital ‚Ä¢ R-E-M</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root{
      color-scheme: dark;

      /* THEME BASE (akan berubah ikut tema) */
      --bg1:#070707; --bg2:#000;
      --accent:#d4af37;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --muted: rgba(255,255,255,.74);
      --radius: 26px;

      /* VIDEO BG (DEFAULT ON) */
      --video-mode: 1;            /* ‚úÖ ON by default */
      --video-opacity: .38;       /* video nampak premium */
      --video-dim: .55;           /* overlay gelap atas video */

      /* MOTION */
      --motion: 1;
    }

    @media (prefers-reduced-motion: reduce){
      :root{ --motion: 0; }
    }

    body{ margin:0; background:#000; color:#fff; min-height:100vh; overflow-x:hidden; }
    .wrap{
      position:relative; min-height:100vh; overflow:hidden;
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
    }
    .layer{ position:absolute; inset:0; pointer-events:none; }

    /* VIDEO */
    #bgVideo{
      width:100%; height:100%;
      object-fit:cover;
      opacity: calc(var(--video-mode) * var(--video-opacity));
      transform: scale(1.05);
      filter: saturate(1.06) contrast(1.03);
      transition: opacity .25s ease;
      z-index: 1;
      background:#000;
    }
    .videoDim{
      z-index:2;
      background: radial-gradient(900px 520px at 20% 10%, rgba(0,0,0,.15), rgba(0,0,0,var(--video-dim)));
      opacity: calc(var(--video-mode) * 1);
      transition: opacity .25s ease;
    }

    /* AURORA / SPARKLE */
    .aurora{
      z-index:3; opacity:.75;
      filter: blur(20px) saturate(1.12);
      background:
        radial-gradient(900px 520px at 10% 20%, color-mix(in srgb, var(--accent) 35%, transparent), transparent 62%),
        radial-gradient(780px 540px at 90% 15%, rgba(34,197,94,.14), transparent 64%),
        radial-gradient(980px 620px at 50% 90%, rgba(251,113,133,.12), transparent 66%);
      animation: auroraMove 14s ease-in-out infinite;
      animation-play-state: var(--motion)==1 ? running : paused;
    }
    @keyframes auroraMove{ 0%,100%{ filter: blur(20px) saturate(1.12);} 50%{ filter: blur(22px) saturate(1.18);} }

    .shimmer{
      z-index:4; opacity:.14; mix-blend-mode: overlay;
      background: linear-gradient(110deg,
        transparent 0%,
        rgba(255,255,255,.10) 30%,
        rgba(255,255,255,.22) 45%,
        rgba(255,255,255,.10) 60%,
        transparent 100%);
      animation: shimmer 4.5s linear infinite;
      animation-play-state: var(--motion)==1 ? running : paused;
    }
    @keyframes shimmer{ 0%{ transform: translateX(-120%);} 100%{ transform: translateX(120%);} }

    /* GLASS CARD */
    .glass{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      position:relative;
      overflow:hidden;
    }

    .chip{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.25);
    }
    .btn{
      border-radius: 16px;
      border:1px solid var(--stroke);
      padding: 12px 14px;
      background: rgba(0,0,0,.22);
      transition: transform .12s ease, opacity .12s ease;
    }
    .btn:active{ transform: scale(.98); }
    .btnPrimary{
      background: var(--accent);
      color:#0b0b0b;
      font-weight: 900;
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 0 18px var(--accent), 0 0 44px rgba(255,255,255,.10);
    }

    .input{
      width:100%;
      border-radius: 16px;
      border:1px solid var(--stroke);
      padding: 12px 14px;
      background: rgba(0,0,0,.25);
      outline:none;
    }

    .qrWrap{
      border-radius: 20px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      padding: 14px;
      display: inline-block;
    }

    /* WATERMARK */
    .wm-wrap{
      position: fixed; inset:0; pointer-events:none;
      z-index: 30;
      opacity:.14; mix-blend-mode: overlay;
    }
    .wm{
      position:absolute; left:-20%; top:30%;
      width:140%; transform: rotate(-18deg);
      display:flex; flex-direction:column; gap:18px;
    }
    .wm-row{
      display:flex; gap:26px; white-space:nowrap;
      font-weight: 800; letter-spacing:.35em; text-transform:uppercase;
      font-size: 13px;
      color: rgba(255,255,255,.9);
      text-shadow: 0 0 10px rgba(0,0,0,.35);
      animation: wmMove 18s linear infinite;
      animation-play-state: var(--motion)==1 ? running : paused;
    }
    .wm-row:nth-child(2){ animation-duration: 22s; opacity:.88; }
    .wm-row:nth-child(3){ animation-duration: 26s; opacity:.74; }
    @keyframes wmMove{ from{ transform: translateX(-6%);} to{ transform: translateX(6%);} }

    /* GATE / TAP-TO-START */
    .gate{
      position: fixed; inset:0; z-index: 60;
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(180deg, #070707, #000);
      display:flex; align-items:center; justify-content:center;
      padding: 22px;
    }
    .fadeUp{ animation: fadeUp .55s ease both; }
    @keyframes fadeUp{ from{opacity:0; transform: translateY(14px)} to{opacity:1; transform:none} }

    /* THEME SHEET */
    .sheetBack{
      position: fixed; inset:0; z-index: 70;
      background: rgba(0,0,0,.55);
      display:none;
    }
    .sheet{
      position: fixed; left:0; right:0; bottom:0; z-index:71;
      transform: translateY(110%);
      transition: .25s ease;
      padding: 14px;
    }
    .sheet.open{ transform: translateY(0); }
  </style>
</head>

<body>
  <div class="wrap" id="wrap">

    <!-- VIDEO LAYER -->
    <video id="bgVideo" class="layer" muted loop playsinline preload="metadata">
      <source src="assets/bg.mp4" type="video/mp4">
    </video>
    <div class="layer videoDim"></div>

    <!-- EFFECTS -->
    <div class="layer aurora"></div>
    <div class="layer shimmer"></div>

    <!-- WATERMARK -->
    <div class="wm-wrap" id="wmWrap">
      <div class="wm">
        <div class="wm-row" id="wm1"></div>
        <div class="wm-row" id="wm2"></div>
        <div class="wm-row" id="wm3"></div>
      </div>
    </div>

    <!-- GATE (tap to enable video/audio on Android) -->
    <div id="gate" class="gate">
      <div class="glass w-full max-w-md p-6 text-center space-y-4 fadeUp">
        <div class="text-xs tracking-[.35em] uppercase opacity-70" id="gLabel">Walimatul Urus</div>
        <div class="text-3xl font-extrabold" id="gTitle">Jemputan Digital</div>
        <div class="text-white/70 text-sm" id="gDesc">Ketik untuk buka jemputan.</div>

        <div class="grid grid-cols-2 gap-2 pt-2">
          <button id="btnEnter" class="btn btnPrimary">Buka</button>
          <button id="btnTheme" class="btn">Tema ‚ú®</button>
        </div>

        <div class="text-xs opacity-50">¬© R-E-M Digital Invitation</div>
      </div>
    </div>

    <!-- MAIN -->
    <div class="relative z-10 p-4 max-w-[560px] mx-auto">
      <div class="glass p-6 text-center space-y-5 fadeUp mt-4">

        <div class="flex items-center justify-between gap-2">
          <div class="flex items-center gap-2">
            <span id="chipPkg" class="chip text-xs px-3 py-2 rounded-full">PRO</span>
            <span id="chipTheme" class="chip text-xs px-3 py-2 rounded-full">Gold</span>
          </div>

          <select id="langPick" class="chip text-sm px-3 py-2 rounded-full bg-transparent">
            <option value="auto">Auto</option>
            <option value="ms">BM</option>
            <option value="en">EN</option>
          </select>
        </div>

        <div class="space-y-2">
          <div class="text-xs tracking-[.35em] uppercase opacity-70" id="labelTop">Walimatul Urus</div>
          <h1 id="outNames" class="text-4xl font-extrabold leading-tight">Adam & Hawa</h1>
          <p id="outLine" class="text-white/70">Dengan penuh kesyukuran, kami menjemput anda hadir.</p>
        </div>

        <div class="border-t border-white/10 pt-4 space-y-2 text-sm text-white/80">
          <div>üìÖ <span id="outDate">01/12/2025</span></div>
          <div>üïö <span id="outTime">9.00am ‚Äì 2.00pm</span></div>
          <div>üìç <span id="outLoc">Dewan Serbaguna</span></div>
          <div class="text-white/60 text-xs"><span id="outAddr">Alamat ringkas majlis di sini</span></div>
        </div>

        <div class="space-y-3 pt-2">
          <input id="guest" class="input" placeholder="Nama tetamu" />
          <div class="grid grid-cols-2 gap-3">
            <button class="btn btnPrimary" id="btnHadir">Hadir</button>
            <button class="btn" id="btnTidak">Tidak Hadir</button>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <button class="btn" id="btnCopy">Copy Link</button>
            <button class="btn hidden" id="btnMaps">Buka Maps</button>
          </div>
        </div>

        <div class="pt-2">
          <div class="qrWrap">
            <div id="qrcode"></div>
          </div>
        </div>

        <div class="text-xs opacity-60" id="footLine">Jemputan Digital ‚Ä¢ Mesra Telefon üì±</div>

        <!-- watermark tap -->
        <div class="pt-4 text-xs opacity-40 select-none text-center">
          <button id="wmTap" type="button" class="underline decoration-white/20">
            ¬© R-E-M Digital Invitation
          </button>
          <a id="adminLink" class="hidden ml-2 px-3 py-1 rounded-full bg-white/10 border border-white/10" href="./admin-android.html">
            Admin
          </a>
        </div>
      </div>
    </div>

    <!-- THEME SHEET -->
    <div id="sheetBack" class="sheetBack"></div>
    <div id="sheet" class="sheet">
      <div class="glass p-4 rounded-[24px] max-w-[560px] mx-auto space-y-3">
        <div class="flex items-center justify-between">
          <div class="font-extrabold text-lg">Tema Premium</div>
          <button id="btnCloseSheet" class="chip px-3 py-2 rounded-full">Tutup</button>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <button class="btn" data-theme="gold">Gold Foil</button>
          <button class="btn" data-theme="aurora">Aurora Silk</button>
          <button class="btn" data-theme="galaxy">Star Galaxy</button>
          <button class="btn" data-theme="emerald">Islamic Emerald</button>
          <button class="btn" data-theme="royal">Royal Purple</button>
          <button class="btn" data-theme="mono">Minimal Mono</button>
        </div>

        <div class="border-t border-white/10 pt-3 space-y-2">
          <div class="flex items-center justify-between gap-3">
            <div class="text-sm text-white/70">Video Background</div>
            <button id="videoToggle" class="btn">Video: ON</button>
          </div>

          <div class="flex items-center justify-between gap-3">
            <div class="text-sm text-white/70">Warna Accent</div>
            <input id="accentPick" type="color" class="w-14 h-11 rounded-xl overflow-hidden border border-white/15 bg-white/5" value="#d4af37">
          </div>

          <div class="flex items-center justify-between gap-3">
            <div class="text-sm text-white/70">Motion</div>
            <button id="motionBtn" class="btn">Motion: ON</button>
          </div>

          <div class="text-xs text-white/50">
            Video fail: <span class="font-mono">KadKahwin4/assets/bg.mp4</span>
          </div>
        </div>

      </div>
    </div>

  </div>

<script>
/* =========================
   DATA (default) + URL overrides
========================= */
const CONFIG = {
  waPhone: "601111661303",
  titleMS: "Walimatul Urus",
  titleEN: "Wedding Invitation",
  couple: "Adam & Hawa",
  date: "01/12/2025",
  time: "9.00am ‚Äì 2.00pm",
  venue: "Dewan Serbaguna",
  address: "Alamat ringkas majlis di sini",
  maps: "https://maps.google.com/",
  messageMS: "Dengan penuh kesyukuran, kami menjemput anda hadir.",
  messageEN: "With gratitude, we invite you to attend."
};

const p = new URLSearchParams(location.search);

// URL overrides (optional)
if (p.get("wa"))   CONFIG.waPhone = (p.get("wa")||"").replace(/[^\d]/g,"");
if (p.get("c"))    CONFIG.couple  = (p.get("c")||"").trim();
if (p.get("date")) CONFIG.date    = (p.get("date")||"").trim();
if (p.get("time")) CONFIG.time    = (p.get("time")||"").trim();
if (p.get("venue"))CONFIG.venue   = (p.get("venue")||"").trim();
if (p.get("addr")) CONFIG.address = (p.get("addr")||"").trim();
if (p.get("maps")) CONFIG.maps    = (p.get("maps")||"").trim();

const presetName = (p.get("name")||"").trim();
if (presetName) document.getElementById("guest").value = presetName;

/* =========================
   THEMES (stabil)
========================= */
const THEMES = {
  gold:   { label:"Gold",   bg1:"#0b0b0b", bg2:"#000000", accent:"#d4af37", card:"rgba(255,255,255,.08)" },
  aurora: { label:"Aurora", bg1:"#070a12", bg2:"#000000", accent:"#39ffcf", card:"rgba(57,255,207,.08)" },
  galaxy: { label:"Galaxy", bg1:"#070712", bg2:"#000000", accent:"#60a5fa", card:"rgba(96,165,250,.08)" },
  emerald:{ label:"Emerald",bg1:"#07120a", bg2:"#000000", accent:"#2ecc71", card:"rgba(46,204,113,.08)" },
  royal:  { label:"Royal",  bg1:"#0a0712", bg2:"#000000", accent:"#a78bfa", card:"rgba(167,139,250,.08)" },
  mono:   { label:"Mono",   bg1:"#0a0a0a", bg2:"#000000", accent:"#ffffff", card:"rgba(255,255,255,.08)" }
};

function setCSSVar(k,v){ document.documentElement.style.setProperty(k,v); }

function applyTheme(key, save=true){
  const t = THEMES[key] || THEMES.gold;
  setCSSVar("--bg1", t.bg1);
  setCSSVar("--bg2", t.bg2);
  setCSSVar("--card", t.card);

  // accent boleh override oleh user (color picker)
  if(!localStorage.getItem("REM_ACCENT")){
    setCSSVar("--accent", t.accent);
    document.getElementById("accentPick").value = t.accent;
  }

  document.getElementById("chipTheme").textContent = t.label;
  if(save) localStorage.setItem("REM_THEME", key);

  setWatermark();
  rebuildQR();
}

/* =========================
   LANGUAGE (BM/EN)
========================= */
function getLang(){
  const pick = document.getElementById("langPick").value;
  if(pick === "ms" || pick === "en") return pick;
  // auto
  return (navigator.language||"").toLowerCase().startsWith("en") ? "en" : "ms";
}

function renderText(){
  const lang = getLang();
  document.getElementById("labelTop").textContent = (lang==="en") ? CONFIG.titleEN : CONFIG.titleMS;
  document.getElementById("outLine").textContent  = (lang==="en") ? CONFIG.messageEN : CONFIG.messageMS;
  document.getElementById("btnHadir").textContent = (lang==="en") ? "Attend" : "Hadir";
  document.getElementById("btnTidak").textContent = (lang==="en") ? "Not attending" : "Tidak Hadir";
  document.getElementById("btnMaps").textContent  = (lang==="en") ? "Open Maps" : "Buka Maps";
  document.getElementById("footLine").textContent = (lang==="en") ? "Digital Invitation ‚Ä¢ Mobile-friendly" : "Jemputan Digital ‚Ä¢ Mesra Telefon üì±";
}

/* =========================
   RENDER DATA
========================= */
function setText(id, val){ const el=document.getElementById(id); if(el) el.textContent = val || ""; }

setText("outNames", CONFIG.couple);
setText("outDate", CONFIG.date);
setText("outTime", CONFIG.time);
setText("outLoc",  CONFIG.venue);
setText("outAddr", CONFIG.address);

const btnMaps = document.getElementById("btnMaps");
if(CONFIG.maps){
  btnMaps.classList.remove("hidden");
  btnMaps.addEventListener("click", ()=> window.open(CONFIG.maps, "_blank"));
}

document.getElementById("langPick").addEventListener("change", ()=>{
  localStorage.setItem("REM_LANG", document.getElementById("langPick").value);
  renderText();
  setWatermark();
});

/* restore language */
const savedLang = localStorage.getItem("REM_LANG");
if(savedLang) document.getElementById("langPick").value = savedLang;

/* =========================
   RSVP WhatsApp
========================= */
function rsvp(status){
  const guestName = (document.getElementById("guest").value || "").trim();
  const lang = getLang();
  const msg = (lang==="en")
    ? `RSVP: ${status}\nName: ${guestName || "-"}\nEvent: ${CONFIG.couple}\nDate: ${CONFIG.date}\nVenue: ${CONFIG.venue}`
    : `RSVP: ${status}\nNama: ${guestName || "-"}\nMajlis: ${CONFIG.couple}\nTarikh: ${CONFIG.date}\nLokasi: ${CONFIG.venue}`;

  const url = "https://wa.me/" + CONFIG.waPhone + "?text=" + encodeURIComponent(msg);
  const w = window.open(url, "_blank");
  if(!w) location.href = url;
}

document.getElementById("btnHadir").addEventListener("click", ()=>rsvp("Hadir"));
document.getElementById("btnTidak").addEventListener("click", ()=>rsvp("Tidak Hadir"));

/* =========================
   Copy Link + QR
========================= */
function rebuildQR(){
  const el = document.getElementById("qrcode");
  el.innerHTML = "";
  new QRCode(el,{
    text: window.location.href,
    width: 210, height: 210,
    colorDark: "#ffffff",
    colorLight: "transparent"
  });
}

document.getElementById("btnCopy").addEventListener("click", async ()=>{
  const btn = document.getElementById("btnCopy");
  try{
    await navigator.clipboard.writeText(window.location.href);
    btn.textContent = "Copied!";
    setTimeout(()=>btn.textContent = "Copy Link", 900);
  }catch(e){
    alert(window.location.href);
  }
});

/* =========================
   Watermark text
========================= */
function setWatermark(){
  const themeKey = localStorage.getItem("REM_THEME") || "gold";
  const themeName = (THEMES[themeKey]?.label || "Gold").toUpperCase();
  const lang = getLang().toUpperCase();
  const tag = `R-E-M ‚Ä¢ ${themeName} ‚Ä¢ ${lang} ‚Ä¢ VIDEO`;

  const makeRow = ()=> Array.from({length:8}).map(()=>tag).join("   ‚Ä¢   ");
  document.getElementById("wm1").textContent = makeRow();
  document.getElementById("wm2").textContent = makeRow();
  document.getElementById("wm3").textContent = makeRow();
}

/* =========================
   Theme sheet open/close
========================= */
const sheetBack = document.getElementById("sheetBack");
const sheet = document.getElementById("sheet");

function openSheet(){
  sheetBack.style.display = "block";
  setTimeout(()=>sheet.classList.add("open"), 10);
}
function closeSheet(){
  sheet.classList.remove("open");
  setTimeout(()=>sheetBack.style.display="none", 220);
}
document.getElementById("btnTheme").addEventListener("click", openSheet);
document.getElementById("btnCloseSheet").addEventListener("click", closeSheet);
sheetBack.addEventListener("click", closeSheet);

/* theme buttons */
document.querySelectorAll("[data-theme]").forEach(b=>{
  b.addEventListener("click", ()=>{
    applyTheme(b.getAttribute("data-theme"), true);
    closeSheet();
  });
});

/* =========================
   Video toggle / Motion / Accent
========================= */
function setVideoMode(on){
  document.documentElement.style.setProperty("--video-mode", on ? "1" : "0");
  localStorage.setItem("REM_VIDEO_ON", on ? "1":"0");
  document.getElementById("videoToggle").textContent = "Video: " + (on ? "ON":"OFF");

  const vid = document.getElementById("bgVideo");
  if(vid){
    if(on) vid.play().catch(()=>{});
    else vid.pause();
  }

  setWatermark();
  rebuildQR();
}

function setMotion(on){
  document.documentElement.style.setProperty("--motion", on ? "1":"0");
  localStorage.setItem("REM_MOTION", on ? "1":"0");
  document.getElementById("motionBtn").textContent = "Motion: " + (on ? "ON":"OFF");
}

document.getElementById("videoToggle").addEventListener("click", ()=>{
  const cur = getComputedStyle(document.documentElement).getPropertyValue("--video-mode").trim()==="1";
  setVideoMode(!cur);
});

document.getElementById("motionBtn").addEventListener("click", ()=>{
  const cur = getComputedStyle(document.documentElement).getPropertyValue("--motion").trim()==="1";
  setMotion(!cur);
});

document.getElementById("accentPick").addEventListener("input", (e)=>{
  const c = e.target.value;
  document.documentElement.style.setProperty("--accent", c);
  localStorage.setItem("REM_ACCENT", c);
  setWatermark();
});

/* =========================
   Hidden Admin (tap watermark 7x)
========================= */
(function(){
  const wm = document.getElementById("wmTap");
  const admin = document.getElementById("adminLink");
  let taps = 0, tmr = null;
  wm.addEventListener("click", ()=>{
    taps++;
    clearTimeout(tmr);
    tmr = setTimeout(()=>taps=0, 1500);
    if(taps>=7){
      admin.classList.remove("hidden");
      taps=0;
    }
  });
})();

/* =========================
   Gate start (Android safe)
========================= */
async function tryPlayVideo(){
  const vid = document.getElementById("bgVideo");
  if(!vid) return;
  try{ await vid.play(); }catch(e){}
}

document.getElementById("btnEnter").addEventListener("click", async ()=>{
  document.getElementById("gate").style.display = "none";

  // ensure video shows after user interaction
  await tryPlayVideo();
});

/* =========================
   BOOT (stabil)
========================= */
(function boot(){
  // theme
  const savedTheme = localStorage.getItem("REM_THEME") || "gold";
  applyTheme(savedTheme, false);

  // accent override
  const savedAccent = localStorage.getItem("REM_ACCENT");
  if(savedAccent){
    document.documentElement.style.setProperty("--accent", savedAccent);
    document.getElementById("accentPick").value = savedAccent;
  }

  // video from URL or storage (default ON)
  const urlVideo = (p.get("video")||"").trim();
  const savedVideo = localStorage.getItem("REM_VIDEO_ON");
  const videoOn = (urlVideo==="0") ? false : (urlVideo==="1" ? true : (savedVideo ? savedVideo==="1" : true));
  setVideoMode(videoOn);

  // motion
  const savedMotion = localStorage.getItem("REM_MOTION");
  setMotion(savedMotion ? savedMotion==="1" : true);

  // texts
  renderText();
  rebuildQR();
  setWatermark();

  // maps link
  // (already handled)

  // try autoplay silently (may fail until gate click)
  tryPlayVideo();
})();
</script>
</body>
</html>
