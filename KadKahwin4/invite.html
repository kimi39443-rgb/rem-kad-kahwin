<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Jemputan</title>
  <style>
    :root{
      --bg:#0b0c10; --glass:rgba(255,255,255,.10); --glass2:rgba(255,255,255,.06);
      --bd:rgba(255,255,255,.14); --txt:#fff; --mut:rgba(255,255,255,.78);
      --acc:#91a4ff; --acc2:#ffd37a;
      --r:22px;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;min-height:100vh;background:#000;color:var(--txt);overflow-x:hidden}
    #bgVideo{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:-2;background:#000}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:-1}
    .wrap{max-width:760px;margin:0 auto;padding:18px 14px 90px}
    .topbar{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-top:8px
    }
    .topbar .tt h1{margin:0;font-size:20px}
    .topbar .tt p{margin:4px 0 0;color:var(--mut);font-size:13px}
    .guestPill{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:999px;background:rgba(255,255,255,.08);
      border:1px solid var(--bd);color:var(--mut);font-weight:800;font-size:13px
    }

    .hero{
      margin-top:14px;
      background:var(--glass);
      border:1px solid var(--bd);
      border-radius:var(--r);
      padding:18px 16px;
      backdrop-filter: blur(12px);
      box-shadow:0 20px 70px rgba(0,0,0,.35);
    }
    .badge{
      display:inline-block;padding:8px 12px;border-radius:999px;
      background:rgba(255,255,255,.08);border:1px solid var(--bd);
      font-weight:900;font-size:12px;letter-spacing:1px;text-transform:uppercase;color:var(--mut);
    }
    .invTitle{margin:12px 0 6px;font-size:44px;line-height:1.05;font-weight:900;letter-spacing:.2px}
    @media(max-width:420px){ .invTitle{font-size:36px} }
    .msg{margin:0;color:var(--mut);line-height:1.6;font-size:14px}
    .couple{
      margin:14px 0 10px;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:14px;
      text-align:center;
      font-size:28px;font-weight:900;
    }

    .btn{
      width:100%;padding:14px 14px;border-radius:18px;border:1px solid var(--bd);
      background:rgba(255,255,255,.10);color:#fff;font-weight:900;cursor:pointer;
    }
    .btn.primary{background:rgba(145,164,255,.30);border-color:rgba(145,164,255,.45)}
    .btn.gold{background:rgba(255,211,122,.22);border-color:rgba(255,211,122,.42);color:#1b1b1b}
    .btnRow{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    @media(min-width:560px){ .btnRow{grid-template-columns:1fr 1fr} }

    .card{
      margin-top:14px;
      background:var(--glass2);
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--r);
      padding:16px;
      backdrop-filter: blur(12px);
    }
    .card h2{margin:0 0 10px;font-size:18px}
    .info{display:grid;grid-template-columns:1fr;gap:10px}
    .item{display:flex;justify-content:space-between;gap:10px;padding:12px;border-radius:16px;background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.10)}
    .item b{color:var(--mut)}
    .item span{font-weight:900;text-align:right}
    .count{
      margin-top:10px; display:grid; grid-template-columns:repeat(4,1fr); gap:10px
    }
    .box{
      text-align:center;padding:12px;border-radius:16px;
      background:rgba(0,0,0,.20);border:1px solid rgba(255,255,255,.10)
    }
    .box .n{font-size:26px;font-weight:1000}
    .box .l{font-size:12px;color:var(--mut);letter-spacing:1px}

    .notice{margin-top:10px;color:rgba(255,255,255,.70);font-size:12px;line-height:1.5}

    /* VIP Modal */
    .vip{
      position:fixed;inset:0;z-index:50;display:none;align-items:center;justify-content:center;
      padding:18px;background:rgba(0,0,0,.72);backdrop-filter:blur(10px)
    }
    .vipCard{
      width:min(520px,100%);background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.16);
      border-radius:22px;padding:18px;text-align:center
    }
    .vipCard h3{margin:0 0 8px;font-size:20px}
    .vipCard p{margin:0 0 14px;color:var(--mut);font-size:13px;line-height:1.5}
    .vipCard input{
      width:100%;padding:14px;border-radius:16px;border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.25);color:#fff;outline:none;font-weight:900
    }
    .vipBtns{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
  </style>
</head>
<body>

  <video id="bgVideo" muted loop playsinline preload="auto">
    <source src="assets/bg.mp4" type="video/mp4" />
  </video>
  <div class="overlay"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="tt">
        <h1 id="topTitle">Kad Kahwin Digital</h1>
        <p id="topSub">Jemputan Rasmi</p>
      </div>
      <div class="guestPill">üë§ <span id="guestName">Tetamu</span></div>
    </div>

    <div class="hero">
      <div class="badge" id="badge">MAJLIS PERKAHWINAN</div>

      <div class="invTitle" id="invTitle">Walimatul Urus</div>
      <p class="msg" id="invMsg">Dengan penuh kesyukuran, kami menjemput anda hadir.</p>

      <div class="couple" id="invCouple">Adam & Hawa</div>

      <div class="btnRow">
        <button class="btn primary" id="btnRSVP">‚úâÔ∏è RSVP Sekarang</button>
        <button class="btn" id="btnMaps">üìç Lihat Lokasi</button>
        <button class="btn" id="btnCal">üóìÔ∏è Add to Calendar</button>
        <button class="btn" id="btnShare">üîó Share</button>
      </div>

      <div class="notice" id="notice"></div>
    </div>

    <div class="card">
      <h2>Maklumat Majlis</h2>
      <div class="info">
        <div class="item"><b>Tarikh</b><span id="invDate">-</span></div>
        <div class="item"><b>Masa</b><span id="invTime">-</span></div>
        <div class="item"><b>Tempat</b><span id="invVenue">-</span></div>
        <div class="item"><b>Alamat</b><span id="invAddr">-</span></div>
      </div>

      <div style="margin-top:14px;color:var(--mut);font-weight:900">Countdown ke hari majlis</div>
      <div class="count">
        <div class="box"><div class="n" id="cdD">0</div><div class="l">HARI</div></div>
        <div class="box"><div class="n" id="cdH">00</div><div class="l">JAM</div></div>
        <div class="box"><div class="n" id="cdM">00</div><div class="l">MINIT</div></div>
        <div class="box"><div class="n" id="cdS">00</div><div class="l">SAAT</div></div>
      </div>
      <div class="notice" id="cdNote"></div>
    </div>
  </div>

  <!-- VIP LOCK -->
  <div class="vip" id="vipGate">
    <div class="vipCard">
      <div class="badge" style="margin-bottom:10px">VIP ONLY</div>
      <h3>Jemputan ini memerlukan kod VIP</h3>
      <p>Sila masukkan kod yang diberi. (Kod diset dalam admin panel)</p>
      <input id="vipInput" placeholder="Contoh: VIP123" />
      <div class="vipBtns">
        <button class="btn primary" id="vipOpen">Buka Jemputan</button>
        <button class="btn" id="vipBack">Kembali</button>
      </div>
      <p class="notice">Tip: kod VIP boleh dihantar kepada tetamu melalui WhatsApp.</p>
    </div>
  </div>

  <script>
    const KEY = "KADKAHWIN_DATA_V2::Karim&Masni"; // fallback kalau buka tanpa share link
    const SESSION_VIP = "KADKAHWIN_VIP_OK_V2";

    const DEFAULT_DATA = {
      lang:"ms",
      theme:"midnight",
      videoOn:"on",
      motion:"on",

      topTitle:"Kad Kahwin Digital",
      topSub:"Jemputan Rasmi",
      badge:"MAJLIS PERKAHWINAN",

      title:"Walimatul Urus",
      couple:"Adam & Hawa",
      guestDefault:"Tetamu",
      message:"Dengan penuh kesyukuran, kami menjemput anda hadir memeriahkan majlis perkahwinan kami.",

      date:"01/12/2025",
      time:"9.00am ‚Äì 2.00pm",
      venue:"Dewan Serbaguna",
      address:"Alamat ringkas majlis di sini",
      maps:"https://maps.google.com/",
      rsvp:"https://wa.me/60123456789?text=Assalamualaikum,%20saya%20nak%20RSVP",

      notice:"Notis: Dilarang guna/jual page ini tanpa kebenaran pemilik.¬Æ R-E-M Creative Studio",
      vipOn:"off",
      vipCode:"VIP123"
    };

    const $ = (id)=>document.getElementById(id);
    const qp = new URLSearchParams(location.search);
    const toName = qp.get("to");
    const fromName = qp.get("from");
    const vStyle = qp.get("v") || "1";

    function safeParse(raw, fb){ try{ return JSON.parse(raw) ?? fb; }catch(e){ return fb; } }

    function b64urlDecode(str){
      try{
        str = str.replace(/-/g,"+").replace(/_/g,"/");
        while(str.length % 4) str += "=";
        const json = decodeURIComponent(escape(atob(str)));
        return JSON.parse(json);
      }catch(e){ return null; }
    }

    function loadData(){
      // 1) dari share link hash #data=
      const h = location.hash || "";
      const m = h.match(/data=([A-Za-z0-9\-_]+)/);
      if(m && m[1]){
        const decoded = b64urlDecode(m[1]);
        if(decoded) return {...DEFAULT_DATA, ...decoded};
      }
      // 2) fallback localStorage (device yang edit)
      const raw = localStorage.getItem(KEY);
      if(raw) return {...DEFAULT_DATA, ...safeParse(raw, {})};
      // 3) default
      return {...DEFAULT_DATA};
    }

    const d = loadData();

    // VIP Gate
    function needVIP(){
      if(d.vipOn !== "on") return false;
      if(sessionStorage.getItem(SESSION_VIP)==="1") return false;
      return true;
    }

    function openVIP(){
      $("vipGate").style.display = "flex";
      document.body.style.overflow = "hidden";
    }
    function closeVIP(){
      $("vipGate").style.display = "none";
      document.body.style.overflow = "";
    }

    $("vipOpen").onclick = ()=>{
      const val = ($("vipInput").value||"").trim();
      if(val && val === d.vipCode){
        sessionStorage.setItem(SESSION_VIP, "1");
        closeVIP();
      }else{
        alert("Kod VIP salah");
      }
    };
    $("vipBack").onclick = ()=> history.length>1 ? history.back() : (location.href="index.html");

    // Apply fields
    $("topTitle").textContent = d.topTitle || "";
    $("topSub").textContent = d.topSub || "";
    $("badge").textContent = (d.badge||"").toUpperCase();

    $("invTitle").textContent = d.title || "";
    $("invMsg").textContent = d.message || "";
    $("invCouple").textContent = d.couple || "";

    $("invDate").textContent = d.date || "";
    $("invTime").textContent = d.time || "";
    $("invVenue").textContent = d.venue || "";
    $("invAddr").textContent = d.address || "";

    // guest label
    $("guestName").textContent = toName || d.guestDefault || "Tetamu";

    // Notice with FROM (optional)
    const noteFrom = fromName ? `Dijemput oleh: ${fromName}. ` : "";
    $("notice").textContent = (noteFrom + (d.notice||"")).trim();

    // Buttons
    $("btnMaps").onclick = ()=> d.maps ? window.open(d.maps, "_blank") : alert("Link Maps belum diisi");
    $("btnRSVP").onclick = ()=> d.rsvp ? window.open(d.rsvp, "_blank") : alert("Link RSVP belum diisi");

    // Add to Calendar (simple Google Calendar link)
    function parseDateDDMMYYYY(s){
      const m = (s||"").match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
      if(!m) return null;
      return {dd:+m[1], mm:+m[2], yyyy:+m[3]};
    }
    function guessTimeRange(timeStr){
      // expect "9.00am ‚Äì 2.00pm" (flex)
      // fallback: 10:00-12:00
      const norm = (timeStr||"").replace(/‚Äì/g,"-").replace(/\s+/g," ").trim();
      const parts = norm.split("-").map(x=>x.trim());
      if(parts.length<2) return null;
      return {start:parts[0], end:parts[1]};
    }
    function to24h(t){
      // accepts: 9.00am / 2.00pm / 9:00am
      const m = (t||"").toLowerCase().match(/^(\d{1,2})(?:[:.](\d{2}))?\s*(am|pm)$/);
      if(!m) return null;
      let hh = +m[1], mm = +(m[2]||"00");
      const ap = m[3];
      if(ap==="pm" && hh!==12) hh+=12;
      if(ap==="am" && hh===12) hh=0;
      return {hh, mm};
    }
    function pad2(n){ return String(n).padStart(2,"0"); }
    function ymdToICS(yyyy,mm,dd,hh,mi){
      // YYYYMMDDTHHMM00Z not using Z (local). For Google calendar, use YYYYMMDDTHHMMSS
      return `${yyyy}${pad2(mm)}${pad2(dd)}T${pad2(hh)}${pad2(mi)}00`;
    }

    $("btnCal").onclick = ()=>{
      const dt = parseDateDDMMYYYY(d.date);
      if(!dt){ alert("Tarikh format salah. Guna 01/12/2025"); return; }

      const tr = guessTimeRange(d.time);
      let st = {hh:10,mm:0}, en = {hh:12,mm:0};
      if(tr){
        const a = to24h(tr.start), b = to24h(tr.end);
        if(a) st=a; if(b) en=b;
      }

      const start = ymdToICS(dt.yyyy, dt.mm, dt.dd, st.hh, st.mm);
      const end   = ymdToICS(dt.yyyy, dt.mm, dt.dd, en.hh, en.mm);

      const text = encodeURIComponent(`${d.title} - ${d.couple}`);
      const details = encodeURIComponent(d.message || "");
      const location = encodeURIComponent(`${d.venue || ""} - ${d.address || ""}`);

      const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${text}&details=${details}&location=${location}&dates=${start}/${end}`;
      window.open(url,"_blank");
    };

    $("btnShare").onclick = async ()=>{
      const shareUrl = location.href;
      try{
        if(navigator.share){
          await navigator.share({title:document.title, text:`${d.title} - ${d.couple}`, url:shareUrl});
        }else{
          await navigator.clipboard.writeText(shareUrl);
          alert("Link disalin (copied) ‚úÖ");
        }
      }catch(e){
        // fallback
        try{ await navigator.clipboard.writeText(shareUrl); alert("Link disalin ‚úÖ"); }
        catch(err){ alert(shareUrl); }
      }
    };

    // Video ON/OFF
    const v = $("bgVideo");
    if(d.videoOn === "off"){
      v.pause(); v.style.display="none";
      document.querySelector(".overlay").style.background="rgba(0,0,0,.70)";
    }else{
      // try autoplay (android/chrome may block only if not muted)
      (async()=>{ try{ v.muted=true; await v.play(); }catch(e){} })();
    }

    // VIP check
    if(needVIP()) openVIP();

    // Countdown (simple: if can't parse, hide)
    function parseCountdownTarget(){
      const dt = parseDateDDMMYYYY(d.date);
      if(!dt) return null;
      // start time from d.time start
      const tr = guessTimeRange(d.time);
      const st = tr ? to24h(tr.start) : null;
      const hh = st ? st.hh : 9;
      const mm = st ? st.mm : 0;
      return new Date(dt.yyyy, dt.mm-1, dt.dd, hh, mm, 0);
    }
    const target = parseCountdownTarget();
    const cdNote = $("cdNote");
    function tick(){
      if(!target){ cdNote.textContent=""; return; }
      const t = target.getTime() - Date.now();
      if(t <= 0){
        $("cdD").textContent="0";
        $("cdH").textContent="00";
        $("cdM").textContent="00";
        $("cdS").textContent="00";
        cdNote.textContent = "Hari ini majlis üéâ";
        return;
      }
      const s = Math.floor(t/1000);
      const d0 = Math.floor(s/86400);
      const h0 = Math.floor((s%86400)/3600);
      const m0 = Math.floor((s%3600)/60);
      const s0 = s%60;
      $("cdD").textContent = d0;
      $("cdH").textContent = String(h0).padStart(2,"0");
      $("cdM").textContent = String(m0).padStart(2,"0");
      $("cdS").textContent = String(s0).padStart(2,"0");
      cdNote.textContent="";
    }
    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
