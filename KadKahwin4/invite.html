<!doctype html>
<html lang="ms" data-theme="floral">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Jemputan</title>
  <style>
    :root{
      --bg:#0f0f12;
      --card:rgba(255,255,255,.10);
      --text:#fff;
      --muted:rgba(255,255,255,.75);
      --accent:#e7c96e;
      --shadow: 0 20px 60px rgba(0,0,0,.28);
      --radius: 26px;
    }
    [data-theme="floral"]{ --bg:#f7f3ef; --card:#ffffffcc; --text:#222; --muted:#666; --accent:#d59aa5; }
    [data-theme="gold"]{ --bg:#0f0f12; --card:rgba(255,255,255,.10); --text:#fff; --muted:rgba(255,255,255,.75); --accent:#e7c96e; }
    [data-theme="midnight"]{ --bg:#05060a; --card:rgba(255,255,255,.08); --text:#fff; --muted:rgba(255,255,255,.72); --accent:#9bb8ff; }
    [data-theme="emerald"]{ --bg:#07110d; --card:rgba(255,255,255,.09); --text:#eafff5; --muted:rgba(234,255,245,.75); --accent:#53f0b7; }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* video bg optional */
    #bgVideo{
      position:fixed; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      z-index:-3;
      background:#000;
      display:none; /* ON/OFF dari data */
    }
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.35);
      z-index:-2;
      display:none;
    }

    .page{
      padding: 18px 16px 26px;
      max-width: 760px;
      margin: 0 auto;
    }
    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin: 10px 0 14px;
    }
    .brand h2{ margin:0; font-size:20px; letter-spacing:.2px; }
    .brand .sub{ opacity:.75; font-size:13px; margin-top:4px; }

    .pill{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      color:#fff;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex; align-items:center; gap:8px;
      min-height:42px;
    }

    .warn{
      margin: 10px 0 14px;
      background: rgba(255,210,120,.14);
      border:1px solid rgba(255,210,120,.30);
      color: var(--text);
      border-radius: 16px;
      padding: 10px 12px;
      display:none;
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 16px;
    }

    .badge{
      display:inline-flex;
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:.95;
      margin-bottom:12px;
    }

    .invTitle{
      font-size: 34px;
      line-height:1.12;
      margin: 2px 0 8px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .msg{
      margin: 0 0 14px;
      opacity:.9;
      line-height:1.55;
      font-size: 15px;
      color: var(--muted);
    }
    .couple{
      margin: 0 0 14px;
      font-size: 28px;
      font-weight: 900;
      padding: 12px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      text-align:center;
    }
    [data-theme="floral"] .couple{
      background: rgba(255,255,255,.45);
      color:#111;
    }

    .info{
      display:grid;
      gap:10px;
      margin-top: 12px;
    }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      opacity:.95;
    }
    .mini{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      min-width: 210px;
    }
    [data-theme="floral"] .mini{ background: rgba(255,255,255,.40); color:#111; }

    .btnRow{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top: 14px;
    }
    .btn, .btn2{
      width:100%;
      min-height: 48px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      cursor:pointer;
      font-weight: 900;
      font-size: 15px;
    }
    .btn{
      background: var(--accent);
      color:#07110d;
    }
    .btn2{
      background: rgba(0,0,0,.18);
      color: var(--text);
    }
    [data-theme="floral"] .btn2{
      background: rgba(255,255,255,.55);
      color:#111;
    }

    .foot{
      margin-top: 14px;
      opacity:.75;
      font-size: 12px;
      text-align:center;
      line-height:1.45;
    }
  </style>
</head>
<body>

  <video id="bgVideo" muted loop playsinline preload="auto">
    <source src="assets/bg.mp4" type="video/mp4" />
  </video>
  <div class="overlay" id="overlay"></div>

  <div class="page">
    <div class="top">
      <div class="brand">
        <h2 id="topTitle">Kad Kahwin Digital</h2>
        <div class="sub" id="topSubtitle">Jemputan Rasmi</div>
      </div>
      <div class="pill" id="guestPill">üë§ <span id="guestName">Tetamu</span></div>
    </div>

    <div class="warn" id="warnBox">‚ö†Ô∏è Link ini dibuka tanpa data tetamu. Untuk tetamu, gunakan link ‚ÄúGenerate‚Äù (ada <b>?d=</b>).</div>

    <div class="card">
      <div class="badge" id="badgeText">WEDDING INVITATION</div>
      <div class="invTitle" id="invTitle">Walimatul Urus</div>
      <p class="msg" id="invMsg">Dengan penuh kesyukuran, kami menjemput anda hadir bagi memeriahkan majlis perkahwinan kami.</p>
      <div class="couple" id="invCouple">Adam &amp; Hawa</div>

      <div class="info">
        <div class="row">
          <div class="mini">üìÖ <span id="invDate">01/12/2025</span></div>
          <div class="mini">üïò <span id="invTime">9.00am ‚Äì 2.00pm</span></div>
        </div>
        <div class="row">
          <div class="mini">üìç <span id="invVenue">Dewan Serbaguna</span></div>
          <div class="mini">üè† <span id="invAddr">Alamat ringkas majlis di sini</span></div>
        </div>
      </div>

      <div class="btnRow">
        <button class="btn" id="btnRsvp">‚úâÔ∏è RSVP Sekarang</button>
        <button class="btn2" id="btnMaps">üìç Lihat Lokasi</button>
        <button class="btn2" id="btnCopy">üîó Copy Link</button>
      </div>

      <div class="foot" id="noticeText">Notis: Dilarang guna/jual page ini tanpa kebenaran pemilik.</div>
    </div>
  </div>

<script>
  // ======= STABLE DATA STRATEGY =======
  // 1) Jika URL ada ?d= ‚Üí guna data itu (tetamu mana-mana phone pun sama)
  // 2) Jika tiada ?d= ‚Üí fallback localStorage (untuk owner/admin)
  const KEY_LOCAL = "KADKAHWIN_DATA_V1";

  const DEFAULT_DATA = {
    theme: "gold",
    videoOn: false,
    topTitle: "Kad Kahwin Digital",
    topSubtitle: "Jemputan Rasmi",
    badge: "WEDDING INVITATION",
    title:"Walimatul Urus",
    couple:"Adam & Hawa",
    date:"01/12/2025",
    time:"9.00am ‚Äì 2.00pm",
    venue:"Dewan Serbaguna",
    address:"Alamat ringkas majlis di sini",
    maps:"https://maps.google.com/",
    rsvp:"https://wa.me/60123456789?text=Assalamualaikum,%20saya%20nak%20RSVP",
    message:"Dengan penuh kesyukuran, kami menjemput anda hadir bagi memeriahkan majlis perkahwinan kami.",
    notice:"Notis: Dilarang guna/jual page ini tanpa kebenaran pemilik.",
    guest:"Tetamu"
  };

  function b64ToObj(b64){
    try{
      const json = decodeURIComponent(escape(atob(b64)));
      return JSON.parse(json);
    }catch(e){ return null; }
  }
  function objToB64(obj){
    const json = JSON.stringify(obj);
    return btoa(unescape(encodeURIComponent(json)));
  }

  function getQuery(name){
    const u = new URL(location.href);
    return u.searchParams.get(name);
  }

  function loadLocal(){
    try{
      const raw = localStorage.getItem(KEY_LOCAL);
      return raw ? JSON.parse(raw) : null;
    }catch(e){ return null; }
  }

  function loadData(){
    const dParam = getQuery("d");
    if(dParam){
      const parsed = b64ToObj(dParam);
      if(parsed) return { source:"url", data: parsed };
    }
    const local = loadLocal();
    if(local) return { source:"local", data: local };
    return { source:"default", data: DEFAULT_DATA };
  }

  const { source, data } = loadData();

  // warn jika tiada ?d=
  const warnBox = document.getElementById("warnBox");
  if(source !== "url") warnBox.style.display = "block";

  // apply theme
  document.documentElement.setAttribute("data-theme", data.theme || DEFAULT_DATA.theme);

  // video (optional)
  const video = document.getElementById("bgVideo");
  const overlay = document.getElementById("overlay");
  function setVideo(on){
    if(on){
      video.style.display="block";
      overlay.style.display="block";
      // autoplay attempt
      video.muted = true;
      video.play().catch(()=>{/* ignore */});
    }else{
      video.pause?.();
      video.style.display="none";
      overlay.style.display="none";
    }
  }
  setVideo(!!data.videoOn);

  // set text helpers
  const set = (id, txt)=>{ const el=document.getElementById(id); if(el) el.textContent = txt||""; };
  set("topTitle", data.topTitle);
  set("topSubtitle", data.topSubtitle);
  set("badgeText", data.badge);
  set("invTitle", data.title);
  set("invMsg", data.message);
  set("invCouple", data.couple);
  set("invDate", data.date);
  set("invTime", data.time);
  set("invVenue", data.venue);
  set("invAddr", data.address);
  set("noticeText", data.notice);
  set("guestName", data.guest || "Tetamu");

  // buttons
  document.getElementById("btnMaps").addEventListener("click", ()=>{
    if(data.maps) window.open(data.maps, "_blank");
  });
  document.getElementById("btnRsvp").addEventListener("click", ()=>{
    if(data.rsvp) window.open(data.rsvp, "_blank");
  });
  document.getElementById("btnCopy").addEventListener("click", async ()=>{
    const u = new URL(location.href);
    // pastikan ada ?d= bila copy
    if(!u.searchParams.get("d")){
      // kalau tiada d, bina dari data semasa (local/default) supaya stable untuk share
      u.searchParams.set("d", objToB64(data));
    }
    try{
      await navigator.clipboard.writeText(u.toString());
      alert("Link sudah di-copy ‚úÖ");
    }catch(e){
      prompt("Copy link ini:", u.toString());
    }
  });
</script>
</body>
</html>
