<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Jemputan Digital</title>

  <!-- QR -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root{
      --bg1:#070707; --bg2:#000;
      --card: rgba(255,255,255,.07);
      --stroke: rgba(255,255,255,.14);
      --text: #fff;
      --muted: rgba(255,255,255,.72);
      --accent: #d4af37;
      --radius: 26px;
      --glow: 0 0 18px var(--accent), 0 0 42px rgba(255,255,255,.10);

      --motion: 1;
      --video-on: 1;
      --video-opacity: .34;
      --overlay-dim: .58;
    }

    @media (prefers-reduced-motion: reduce){
      :root{ --motion: 0; }
    }

    *{ box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body{ margin:0; color:var(--text); min-height:100vh; background: linear-gradient(180deg, var(--bg1), var(--bg2)); overflow-x:hidden; }

    .wrap{ position:relative; min-height:100vh; overflow:hidden; }
    .layer{ position:absolute; inset:0; pointer-events:none; }

    /* VIDEO */
    #bgVideo{
      width:100%; height:100%;
      object-fit:cover;
      opacity: calc(var(--video-on) * var(--video-opacity));
      filter: saturate(1.05) contrast(1.03);
      transform: scale(1.05);
      z-index:1;
      background:#000;
    }
    .dim{ z-index:2; background: rgba(0,0,0,var(--overlay-dim)); }

    /* PREMIUM BACKGROUND */
    .aurora{
      z-index:3;
      opacity:.85;
      filter: blur(20px) saturate(1.12);
      background:
        radial-gradient(900px 520px at 10% 20%, color-mix(in srgb, var(--accent) 35%, transparent), transparent 62%),
        radial-gradient(720px 520px at 90% 15%, rgba(34,197,94,.14), transparent 64%),
        radial-gradient(980px 620px at 50% 90%, rgba(251,113,133,.12), transparent 66%);
      animation: aur 16s ease-in-out infinite;
      animation-play-state: var(--motion)==1 ? running : paused;
    }
    @keyframes aur{ 0%,100%{filter:blur(20px) saturate(1.12)} 50%{filter:blur(22px) saturate(1.18)} }

    .stars{
      z-index:4;
      opacity:.28;
      background:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.65), transparent 55%),
        radial-gradient(1px 1px at 30% 80%, rgba(255,255,255,.55), transparent 55%),
        radial-gradient(1px 1px at 70% 30%, rgba(255,255,255,.55), transparent 55%),
        radial-gradient(1px 1px at 90% 70%, rgba(255,255,255,.55), transparent 55%),
        radial-gradient(2px 2px at 25% 35%, rgba(255,255,255,.40), transparent 60%),
        radial-gradient(2px 2px at 78% 62%, rgba(255,255,255,.40), transparent 60%);
      animation: drift 18s linear infinite;
      animation-play-state: var(--motion)==1 ? running : paused;
    }
    @keyframes drift{ from{transform:translate3d(0,0,0)} to{transform:translate3d(-3%,2%,0)} }

    .shimmer{
      z-index:5;
      opacity:.18;
      mix-blend-mode: overlay;
      background: linear-gradient(110deg,
        transparent 0%,
        rgba(255,255,255,.10) 30%,
        rgba(255,255,255,.22) 45%,
        rgba(255,255,255,.10) 60%,
        transparent 100%);
      animation: shim 4.5s linear infinite;
      animation-play-state: var(--motion)==1 ? running : paused;
    }
    @keyframes shim{ from{transform:translateX(-120%)} to{transform:translateX(120%)} }

    /* CARD */
    .container{ position:relative; z-index:10; max-width:580px; margin:0 auto; padding:14px; }
    .glass{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      overflow:hidden;
    }

    .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .chip{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.25);
      border-radius:999px;
      padding:10px 12px;
      font-size:11px;
      letter-spacing:.22em;
      text-transform:uppercase;
      opacity:.9;
    }
    .btn{
      border-radius: 16px;
      border: 1px solid var(--stroke);
      padding: 12px 14px;
      background: rgba(0,0,0,.22);
      color: #fff;
      font-weight: 800;
      cursor: pointer;
    }
    .btn:active{ transform: scale(.98); }
    .btnPrimary{
      background: var(--accent);
      color: #0b0b0b;
      border-color: rgba(255,255,255,.18);
      box-shadow: var(--glow);
    }
    .input{
      width:100%;
      border-radius: 16px;
      border:1px solid var(--stroke);
      padding: 12px 14px;
      background: rgba(0,0,0,.25);
      outline:none;
      color:#fff;
    }
    .muted{ color: var(--muted); }
    .title{ font-size: 34px; line-height:1.1; font-weight: 950; }
    .sub{ letter-spacing:.35em; text-transform:uppercase; font-size:11px; opacity:.75; }
    .hr{ border-top:1px solid rgba(255,255,255,.10); }

    /* Gate (Tap to start) */
    .gate{
      position: fixed; inset:0;
      z-index: 50;
      display:flex; align-items:center; justify-content:center;
      padding: 20px;
      background: rgba(0,0,0,.72);
    }
    .gateCard{
      width:min(520px,100%);
      padding: 18px;
      border-radius: 22px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      text-align:center;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
    }
    .gateTitle{ font-size:18px; font-weight:900; margin-bottom:6px; }
    .gateDesc{ font-size:13px; opacity:.85; line-height:1.5; margin-bottom:12px; }

    /* VIP Lock Gate */
    .vipBack{
      position: fixed; inset:0;
      z-index: 60;
      display:none;
      align-items:center; justify-content:center;
      padding: 20px;
      background: rgba(0,0,0,.78);
    }

    .qrWrap{
      display:inline-block;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      padding: 12px;
    }

    /* Watermark tap admin */
    .wm-wrap{ position: fixed; inset:0; pointer-events:none; z-index: 40; opacity:.14; mix-blend-mode: overlay; }
    .wm{ position:absolute; left:-20%; top:30%; width:140%; transform:rotate(-18deg); display:flex; flex-direction:column; gap:18px; }
    .wm-row{
      display:flex; gap:26px; white-space:nowrap;
      font-weight:900; letter-spacing:.35em; text-transform:uppercase; font-size:12px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 0 10px rgba(0,0,0,.35);
      animation: wmMove 18s linear infinite;
      animation-play-state: var(--motion)==1 ? running : paused;
    }
    .wm-row:nth-child(2){ animation-duration: 22s; opacity:.85; }
    .wm-row:nth-child(3){ animation-duration: 26s; opacity:.70; }
    @keyframes wmMove{ from{ transform: translateX(-6%);} to{ transform: translateX(6%);} }

    .footTap{ padding-top:14px; font-size:12px; opacity:.45; text-align:center; }
    .linkTiny{ color:#fff; opacity:.7; text-decoration: underline; text-decoration-color: rgba(255,255,255,.25); }

    /* Responsive */
    @media (max-width:380px){
      .title{ font-size: 30px; }
    }
  </style>
</head>

<body>
  <div class="wrap" id="wrap">

    <!-- VIDEO -->
    <video id="bgVideo" class="layer" muted loop playsinline preload="metadata">
      <!-- Letak video anda di KadKahwin4/assets/bg.mp4 -->
      <source src="./assets/bg.mp4" type="video/mp4" />
    </video>

    <div class="layer dim"></div>
    <div class="layer aurora"></div>
    <div class="layer stars"></div>
    <div class="layer shimmer"></div>

    <!-- WATERMARK -->
    <div class="wm-wrap" id="wmWrap">
      <div class="wm">
        <div class="wm-row" id="wm1"></div>
        <div class="wm-row" id="wm2"></div>
        <div class="wm-row" id="wm3"></div>
      </div>
    </div>

    <div class="container">
      <div class="glass" style="padding:18px;">
        <div class="row">
          <div class="row" style="gap:8px;">
            <span class="chip" id="chipPkg">PRO</span>
            <span class="chip" id="chipVer">V1</span>
            <span class="chip" id="chipToFrom">‚Äî</span>
          </div>

          <select id="verPicker" class="chip" style="background:transparent; color:#fff;">
            <option value="1">Versi 1</option>
            <option value="2">Versi 2</option>
            <option value="3">Versi 3</option>
            <option value="4">Versi 4</option>
            <option value="5">Versi 5</option>
          </select>
        </div>

        <div style="padding-top:14px; text-align:center;">
          <div class="sub" id="invTitle">Walimatul Urus</div>
          <div class="title" id="invCouple">Adam & Hawa</div>
          <div class="muted" id="invMsg" style="margin-top:8px; line-height:1.55;">
            Dengan penuh kesyukuran, kami menjemput anda hadir.
          </div>
        </div>

        <div class="hr" style="margin:16px 0;"></div>

        <div style="display:grid; gap:8px; font-size:14px;">
          <div>üìÖ <span id="invDate">01/12/2025</span></div>
          <div>üïö <span id="invTime">9.00am ‚Äì 2.00pm</span></div>
          <div>üìç <span id="invVenue">Dewan Serbaguna</span></div>
          <div class="muted" id="invAddr">Alamat ringkas majlis di sini</div>
        </div>

        <div class="hr" style="margin:16px 0;"></div>

        <div style="display:grid; gap:10px;">
          <input id="guest" class="input" placeholder="Nama tetamu (untuk RSVP)" />

          <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button class="btn btnPrimary" id="btnHadir">Hadir</button>
            <button class="btn" id="btnTidak">Tidak Hadir</button>
          </div>

          <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button class="btn" id="btnCopy">Copy Link</button>
            <button class="btn" id="btnMaps" style="display:none;">Buka Maps</button>
          </div>
        </div>

        <div style="padding-top:14px; text-align:center;">
          <div class="qrWrap"><div id="qrcode"></div></div>
          <div class="muted" style="margin-top:10px; font-size:12px;">
            Scan QR untuk buka jemputan.
          </div>
        </div>

        <div class="footTap">
          <button id="wmTap" type="button" class="linkTiny">¬© R-E-M Digital Invitation</button>
          <a id="adminLink" class="linkTiny" href="./admin-android.html" style="display:none; margin-left:10px;">Admin</a>
        </div>
      </div>
    </div>

    <!-- Tap-to-start Gate (Android/Chrome autoplay safe) -->
    <div id="gate" class="gate">
      <div class="gateCard">
        <div class="gateTitle" id="gTitle">Ketik untuk mula</div>
        <div class="gateDesc" id="gDesc">
          Untuk Chrome/Android, video & audio perlukan 1 sentuhan untuk mula.
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px;">
          <button class="btn btnPrimary" id="btnEnter">Buka</button>
          <button class="btn" id="btnMotion">Motion: ON</button>
        </div>
        <div class="muted" style="margin-top:10px; font-size:12px;">
          Jika video tiada, pastikan fail <span class="mono">assets/bg.mp4</span> wujud.
        </div>
      </div>
    </div>

    <!-- VIP Lock Gate -->
    <div id="vipBack" class="vipBack">
      <div class="gateCard">
        <div class="gateTitle">VIP / Family</div>
        <div class="gateDesc">Masukkan VIP code untuk buka jemputan.</div>
        <input id="vipInput" class="input" placeholder="VIP code" />
        <button class="btn btnPrimary" id="btnVipGo" style="width:100%; margin-top:10px;">Unlock</button>
        <div id="vipMsg" class="muted" style="margin-top:10px; font-size:12px; color:#ffb4b4;"></div>
      </div>
    </div>

  </div>

<script>
/* =========================
   DEFAULT DATA (fallback)
========================= */
const DEFAULT_DATA = {
  title:"Walimatul Urus",
  couple:"Adam & Hawa",
  date:"01/12/2025",
  time:"9.00am ‚Äì 2.00pm",
  venue:"Dewan Serbaguna",
  address:"Alamat ringkas majlis di sini",
  maps:"https://maps.google.com/",
  wa:"601111661303",
  message:"Dengan penuh kesyukuran, kami menjemput anda hadir.",
  music:"",
  vipOn: 0,
  vipPass: "VIP123",
  pkg: "pro"
};

const qs = new URLSearchParams(location.search);
let v = parseInt(qs.get("v") || "1", 10);
if(isNaN(v) || v < 1 || v > 5) v = 1;

/* =========================
   Decode payload c= from admin
========================= */
function decodePayload(c){
  try{
    const json = decodeURIComponent(escape(atob(c)));
    return JSON.parse(json);
  }catch(e){ return null; }
}

/* priority: c=payload > localStorage > default */
function loadData(){
  // payload
  const c = qs.get("c");
  if(c){
    const obj = decodePayload(c);
    if(obj && typeof obj === "object") return obj;
  }
  // local fallback (optional)
  try{
    const raw = localStorage.getItem("KADKAHWIN_DATA_V1");
    if(raw) return JSON.parse(raw);
  }catch(e){}
  return DEFAULT_DATA;
}

const d = { ...DEFAULT_DATA, ...loadData() };

/* =========================
   Themes v1‚Äìv5
========================= */
const THEMES = {
  1:{ accent:"#d4af37", bg1:"#0b0b0b", bg2:"#000000", card:"rgba(255,255,255,.07)" }, // gold
  2:{ accent:"#39ffcf", bg1:"#070a12", bg2:"#000000", card:"rgba(57,255,207,.07)" }, // neon
  3:{ accent:"#ffffff", bg1:"#0a0a0a", bg2:"#000000", card:"rgba(255,255,255,.07)" }, // mono
  4:{ accent:"#2ecc71", bg1:"#07120a", bg2:"#000000", card:"rgba(46,204,113,.07)" }, // islamic
  5:{ accent:"#a78bfa", bg1:"#0a0712", bg2:"#000000", card:"rgba(167,139,250,.07)" }  // royal
};

function applyTheme(ver){
  const t = THEMES[ver] || THEMES[1];
  document.documentElement.style.setProperty("--accent", t.accent);
  document.documentElement.style.setProperty("--bg1", t.bg1);
  document.documentElement.style.setProperty("--bg2", t.bg2);
  document.documentElement.style.setProperty("--card", t.card);
  document.getElementById("chipVer").textContent = "V" + ver;
  document.getElementById("verPicker").value = String(ver);
}
applyTheme(v);

/* =========================
   Render
========================= */
const setText = (id, val)=>{ const el=document.getElementById(id); if(el) el.textContent = val ?? ""; };

setText("invTitle", d.title || DEFAULT_DATA.title);
setText("invCouple", d.names || d.couple || DEFAULT_DATA.couple);
setText("invDate", d.date || DEFAULT_DATA.date);
setText("invTime", d.time || DEFAULT_DATA.time);
setText("invVenue", d.location || d.venue || DEFAULT_DATA.venue);
setText("invAddr", d.address || DEFAULT_DATA.address);
setText("invMsg", d.message || DEFAULT_DATA.message);

/* =========================
   To / From display (URL params)
========================= */
const toName = (qs.get("to") || qs.get("name") || "").trim();
const fromName = (qs.get("from") || "").trim();

const chipToFrom = document.getElementById("chipToFrom");
if(toName || fromName){
  const a = toName ? ("TO: " + toName) : "";
  const b = fromName ? ("FROM: " + fromName) : "";
  chipToFrom.textContent = [a,b].filter(Boolean).join(" ‚Ä¢ ");
} else {
  chipToFrom.textContent = "GUEST";
}

/* =========================
   Package display
========================= */
document.getElementById("chipPkg").textContent = String((d.pkg || qs.get("pkg") || "PRO")).toUpperCase();

/* =========================
   Maps
========================= */
const mapsUrl = (d.maps || d.MAPS_URL || "").trim();
const btnMaps = document.getElementById("btnMaps");
if(mapsUrl){
  btnMaps.style.display = "block";
  btnMaps.addEventListener("click", ()=> window.open(mapsUrl, "_blank"));
}

/* =========================
   RSVP WhatsApp
========================= */
function buildWaLink(status){
  const guest = (document.getElementById("guest").value || "").trim();
  const couple = (d.names || d.couple || DEFAULT_DATA.couple);
  const msg =
`RSVP ${status}
Nama: ${guest || "-"}
To: ${toName || "-"}
From: ${fromName || "-"}
Majlis: ${couple}
Tarikh: ${d.date || DEFAULT_DATA.date}
Masa: ${d.time || DEFAULT_DATA.time}
Lokasi: ${(d.location || d.venue || DEFAULT_DATA.venue)}`;

  const wa = String(d.wa || d.WA_PHONE || DEFAULT_DATA.wa).replace(/[^\d]/g,"");
  return "https://wa.me/" + wa + "?text=" + encodeURIComponent(msg);
}

document.getElementById("btnHadir").addEventListener("click", ()=>{
  const url = buildWaLink("Hadir");
  const w = window.open(url, "_blank");
  if(!w) location.href = url;
});
document.getElementById("btnTidak").addEventListener("click", ()=>{
  const url = buildWaLink("Tidak Hadir");
  const w = window.open(url, "_blank");
  if(!w) location.href = url;
});

/* =========================
   Copy link + QR
========================= */
function rebuildQR(){
  const el = document.getElementById("qrcode");
  el.innerHTML = "";
  new QRCode(el, {
    text: window.location.href,
    width: 200,
    height: 200,
    colorDark: "#ffffff",
    colorLight: "transparent"
  });
}
rebuildQR();

document.getElementById("btnCopy").addEventListener("click", async ()=>{
  const btn = document.getElementById("btnCopy");
  try{
    await navigator.clipboard.writeText(window.location.href);
    btn.textContent = "Copied!";
    setTimeout(()=>btn.textContent="Copy Link", 1100);
  }catch(e){
    alert(window.location.href);
  }
});

/* =========================
   Watermark text + hidden admin (7 taps)
========================= */
function setWatermark(){
  const couple = (d.names || d.couple || DEFAULT_DATA.couple).toUpperCase();
  const tag = `R-E-M ‚Ä¢ ${couple} ‚Ä¢ V${v} ‚Ä¢ PREMIUM`;
  const makeRow = ()=> Array.from({length:8}).map(()=>tag).join("   ‚Ä¢   ");
  document.getElementById("wm1").textContent = makeRow();
  document.getElementById("wm2").textContent = makeRow();
  document.getElementById("wm3").textContent = makeRow();
}
setWatermark();

(function(){
  const wm = document.getElementById("wmTap");
  const admin = document.getElementById("adminLink");
  if(!wm || !admin) return;

  let taps = 0, tmr = null;
  wm.addEventListener("click", ()=>{
    taps++;
    clearTimeout(tmr);
    tmr = setTimeout(()=>taps=0, 1500);
    if(taps >= 7){
      admin.style.display = "inline";
      taps = 0;
    }
  });
})();

/* =========================
   Version change
========================= */
document.getElementById("verPicker").addEventListener("change", ()=>{
  const next = parseInt(document.getElementById("verPicker").value, 10);
  if(isNaN(next)) return;
  v = next;
  qs.set("v", String(v));
  history.replaceState(null, "", location.pathname + "?" + qs.toString());
  applyTheme(v);
  setWatermark();
  rebuildQR();
});

/* =========================
   Motion toggle
========================= */
const motionBtn = document.getElementById("btnMotion");
function setMotion(on){
  document.documentElement.style.setProperty("--motion", on ? "1":"0");
  motionBtn.textContent = "Motion: " + (on ? "ON" : "OFF");
  try{ localStorage.setItem("REM_MOTION", on ? "1":"0"); }catch(e){}
}
setMotion((localStorage.getItem("REM_MOTION") ?? "1") === "1");
motionBtn.addEventListener("click", ()=>{
  const cur = getComputedStyle(document.documentElement).getPropertyValue("--motion").trim() === "1";
  setMotion(!cur);
});

/* =========================
   VIP Lock (from payload)
========================= */
const vipOn = Number(d.vipOn || 0) === 1;
const vipPass = String(d.vipPass || DEFAULT_DATA.vipPass || "VIP123");
const VIP_OK_KEY = "REM_VIP_OK_SESSION_V1";

function showVip(){
  const vipBack = document.getElementById("vipBack");
  vipBack.style.display = "flex";
}
function hideVip(){
  const vipBack = document.getElementById("vipBack");
  vipBack.style.display = "none";
}

document.getElementById("btnVipGo").addEventListener("click", ()=>{
  const val = (document.getElementById("vipInput").value || "").trim();
  const msg = document.getElementById("vipMsg");
  if(val === vipPass){
    sessionStorage.setItem(VIP_OK_KEY, "1");
    hideVip();
  }else{
    msg.textContent = "VIP code salah. Cuba lagi.";
  }
});

/* =========================
   Tap-to-start gate (Android safe)
========================= */
const gate = document.getElementById("gate");
const btnEnter = document.getElementById("btnEnter");
const video = document.getElementById("bgVideo");

async function tryPlayVideo(){
  if(!video) return true;
  try{
    video.muted = true;
    await video.play();
    return true;
  }catch(e){
    return false;
  }
}

btnEnter.addEventListener("click", async ()=>{
  // VIP check dahulu
  if(vipOn && sessionStorage.getItem(VIP_OK_KEY) !== "1"){
    showVip();
  }
  gate.style.display = "none";
  await tryPlayVideo();
});

// kalau VIP ON, block dulu sampai unlock
if(vipOn && sessionStorage.getItem(VIP_OK_KEY) !== "1"){
  showVip();
}

/* try autoplay on load (some browsers allow muted autoplay) */
window.addEventListener("load", async ()=>{
  await tryPlayVideo();
});
</script>
</body>
</html>
