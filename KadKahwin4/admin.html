<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel ‚Ä¢ R-E-M</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-black text-white p-4">
  <div class="max-w-3xl mx-auto space-y-4">
    <div class="p-4 rounded-2xl bg-white/5 border border-white/10">
      <div class="flex items-center justify-between gap-3">
        <div>
          <h1 class="text-xl font-semibold">Admin Panel</h1>
          <p class="text-white/60 text-sm">Edit info pelanggan ‚Üí jana 5 link versi ‚Üí copy.</p>
        </div>
        <button id="btnLogout" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10">Logout</button>
      </div>
    </div>

    <!-- LOGIN -->
    <div id="loginBox" class="p-4 rounded-2xl bg-white/5 border border-white/10 space-y-3 hidden">
      <div class="text-white/80">Masukkan password admin:</div>
      <input id="pass" type="password" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="Password" />
      <button id="btnLogin" class="w-full px-4 py-3 rounded-xl bg-white text-black font-semibold">Masuk</button>
      <div id="loginMsg" class="text-sm text-red-300"></div>
    </div>

    <!-- MAIN -->
    <div id="mainBox" class="space-y-4 hidden">
      <div class="p-4 rounded-2xl bg-white/5 border border-white/10">
        <div class="flex flex-wrap gap-2 items-center justify-between">
          <div class="flex gap-2 items-center">
            <select id="customerSelect" class="px-3 py-2 rounded-xl bg-black/40 border border-white/10">
            </select>
            <button id="btnNew" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10">+ New</button>
            <button id="btnDelete" class="px-3 py-2 rounded-xl bg-red-500/20 border border-red-400/30 text-red-200">Delete</button>
          </div>

          <div class="flex gap-2">
            <button id="btnExport" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10">Export JSON</button>
            <label class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 cursor-pointer">
              Import JSON <input id="importFile" type="file" accept="application/json" class="hidden">
            </label>
          </div>
        </div>
      </div>

      <div class="p-4 rounded-2xl bg-white/5 border border-white/10 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <div class="text-xs text-white/60 mb-1">Nama Pengantin Lelaki</div>
            <input id="groom" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="Adam bin Ahmad">
          </div>
          <div>
            <div class="text-xs text-white/60 mb-1">Nama Pengantin Perempuan</div>
            <input id="bride" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="Hawa binti Ali">
          </div>

          <div>
            <div class="text-xs text-white/60 mb-1">Tarikh</div>
            <input id="date" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="Sabtu, 12 Oktober 2025">
          </div>
          <div>
            <div class="text-xs text-white/60 mb-1">Masa</div>
            <input id="time" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="11.00 pagi ‚Äì 4.00 petang">
          </div>

          <div>
            <div class="text-xs text-white/60 mb-1">Lokasi (Nama Dewan)</div>
            <input id="venue" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="Dewan Seri Melur">
          </div>
          <div>
            <div class="text-xs text-white/60 mb-1">Google Maps Link</div>
            <input id="maps" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="https://maps.google.com/?q=...">
          </div>

          <div>
            <div class="text-xs text-white/60 mb-1">WhatsApp (format antarabangsa tanpa +)</div>
            <input id="wa" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="601111661303">
          </div>
          <div>
            <div class="text-xs text-white/60 mb-1">Watermark</div>
            <input id="wm" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="¬© R-E-M Digital Invitation">
          </div>

          <div>
            <div class="text-xs text-white/60 mb-1">VIP / Family Label (optional)</div>
            <input id="tag" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none" placeholder="VIP / FAMILY / kosong">
          </div>
          <div>
            <div class="text-xs text-white/60 mb-1">Base URL folder (auto)</div>
            <input id="baseUrl" class="w-full px-4 py-3 rounded-xl bg-black/40 border border-white/10 outline-none">
          </div>
        </div>

        <div class="flex flex-wrap gap-2">
          <button id="btnSave" class="px-4 py-3 rounded-xl bg-white text-black font-semibold">Save Customer</button>
          <button id="btnOpen" class="px-4 py-3 rounded-xl bg-white/10 border border-white/10">Open Invite</button>
        </div>
      </div>

      <div class="p-4 rounded-2xl bg-white/5 border border-white/10 space-y-3">
        <div class="flex items-center justify-between gap-3">
          <div>
            <div class="font-semibold">Generate 5 Link Versi</div>
            <div class="text-white/60 text-sm">Setiap link siap config (c=...). Tekan Copy.</div>
          </div>
        </div>

        <div id="links" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
      </div>
    </div>
  </div>

<script>
  // ===== SETTINGS =====
  const ADMIN_PASS = "1234"; // ‚úÖ tukar password sini

  // ===== UTIL =====
  const $ = (id) => document.getElementById(id);
  const storeKey = "rem_customers_v1";

  function b64Encode(str){
    return btoa(unescape(encodeURIComponent(str)));
  }
  function b64Decode(str){
    return decodeURIComponent(escape(atob(str)));
  }

  function loadCustomers(){
    try { return JSON.parse(localStorage.getItem(storeKey) || "[]"); }
    catch { return []; }
  }
  function saveCustomers(list){
    localStorage.setItem(storeKey, JSON.stringify(list));
  }

  function uid(){
    return "C" + Math.random().toString(16).slice(2) + Date.now().toString(16);
  }

  function getBaseUrlAuto(){
    // contoh: https://xxx.github.io/rem-kad-kahwin/KadKahwin4/
    const p = location.href.split("/").slice(0, -1).join("/") + "/";
    return p;
  }

  function currentForm(){
    return {
      id: $("customerSelect").value || uid(),
      groom: $("groom").value.trim(),
      bride: $("bride").value.trim(),
      date: $("date").value.trim(),
      time: $("time").value.trim(),
      venue: $("venue").value.trim(),
      maps: $("maps").value.trim(),
      wa: $("wa").value.trim(),
      wm: $("wm").value.trim(),
      tag: $("tag").value.trim(),
    };
  }

  function fillForm(c){
    $("groom").value = c.groom || "";
    $("bride").value = c.bride || "";
    $("date").value = c.date || "";
    $("time").value = c.time || "";
    $("venue").value = c.venue || "";
    $("maps").value = c.maps || "";
    $("wa").value = c.wa || "";
    $("wm").value = c.wm || "";
    $("tag").value = c.tag || "";
  }

  function renderSelect(list, selectedId){
    $("customerSelect").innerHTML = "";
    if(list.length === 0){
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = "No customers";
      $("customerSelect").appendChild(opt);
      return;
    }
    list.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c.id;
      opt.textContent = `${c.groom || "?"} & ${c.bride || "?"} (${c.id.slice(0,6)})`;
      if(c.id === selectedId) opt.selected = true;
      $("customerSelect").appendChild(opt);
    });
  }

  function makeConfigPayload(c){
    // payload yang dihantar dalam URL
    const payload = {
      groom: c.groom, bride: c.bride,
      date: c.date, time: c.time,
      venue: c.venue, maps: c.maps,
      wa: c.wa, wm: c.wm, tag: c.tag
    };
    return b64Encode(JSON.stringify(payload));
  }

  function renderLinks(c){
    const base = $("baseUrl").value.trim() || getBaseUrlAuto();
    const payload = makeConfigPayload(c);
    const versions = [
      {v:1, name:"Versi 1 ‚Äî Premium Gold"},
      {v:2, name:"Versi 2 ‚Äî Modern Neon"},
      {v:3, name:"Versi 3 ‚Äî Minimal Mono"},
      {v:4, name:"Versi 4 ‚Äî Islamic Emerald"},
      {v:5, name:"Versi 5 ‚Äî Royal Purple"},
    ];

    $("links").innerHTML = "";
    versions.forEach(item => {
      const link = `${base}invite.html?v=${item.v}&c=${encodeURIComponent(payload)}`;
      const box = document.createElement("div");
      box.className = "p-3 rounded-2xl bg-black/30 border border-white/10 space-y-2";
      box.innerHTML = `
        <div class="text-sm font-semibold">${item.name}</div>
        <input class="w-full px-3 py-2 rounded-xl bg-black/40 border border-white/10 text-xs"
               value="${link}" readonly />
        <div class="flex gap-2">
          <button class="copy px-3 py-2 rounded-xl bg-white text-black text-sm font-semibold">Copy</button>
          <a class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 text-sm"
             href="${link}" target="_blank">Open</a>
        </div>
      `;
      box.querySelector(".copy").onclick = async () => {
        await navigator.clipboard.writeText(link);
        box.querySelector(".copy").textContent = "Copied ‚úì";
        setTimeout(()=> box.querySelector(".copy").textContent = "Copy", 1000);
      };
      $("links").appendChild(box);
    });
  }

  // ===== AUTH =====
  function isAuthed(){
    return sessionStorage.getItem("rem_admin_ok") === "1";
  }
  function setAuthed(v){
    sessionStorage.setItem("rem_admin_ok", v ? "1" : "0");
  }

  function showAuthUI(){
    $("loginBox").classList.toggle("hidden", isAuthed());
    $("mainBox").classList.toggle("hidden", !isAuthed());
  }

  // ===== INIT =====
  $("baseUrl").value = getBaseUrlAuto();
  showAuthUI();

  $("btnLogin").onclick = () => {
    const p = $("pass").value;
    if(p === ADMIN_PASS){
      setAuthed(true);
      $("loginMsg").textContent = "";
      showAuthUI();
      boot();
    } else {
      $("loginMsg").textContent = "Password salah.";
    }
  };

  $("btnLogout").onclick = () => {
    setAuthed(false);
    showAuthUI();
  };

  function boot(){
    const list = loadCustomers();
    if(list.length === 0){
      const def = {
        id: uid(),
        groom:"Adam bin Ahmad", bride:"Hawa binti Ali",
        date:"Sabtu, 12 Oktober 2025",
        time:"11.00 pagi ‚Äì 4.00 petang",
        venue:"Dewan Seri Melur",
        maps:"",
        wa:"601111661303",
        wm:"¬© R-E-M Digital Invitation",
        tag:""
      };
      saveCustomers([def]);
    }

    const list2 = loadCustomers();
    const selectedId = list2[0]?.id || "";
    renderSelect(list2, selectedId);
    const c = list2.find(x => x.id === selectedId);
    if(c) fillForm(c);
    renderLinks(currentForm());
  }

  if(isAuthed()) boot();

  $("customerSelect").onchange = () => {
    const list = loadCustomers();
    const c = list.find(x => x.id === $("customerSelect").value);
    if(c) fillForm(c);
    renderLinks(currentForm());
  };

  ["groom","bride","date","time","venue","maps","wa","wm","tag"].forEach(id=>{
    $(id).addEventListener("input", ()=> renderLinks(currentForm()));
  });

  $("btnSave").onclick = () => {
    const c = currentForm();
    const list = loadCustomers();
    const idx = list.findIndex(x => x.id === c.id);
    if(idx >= 0) list[idx] = c; else list.unshift(c);
    saveCustomers(list);
    renderSelect(list, c.id);
    renderLinks(c);
    $("btnSave").textContent = "Saved ‚úì";
    setTimeout(()=> $("btnSave").textContent="Save Customer", 900);
  };

  $("btnNew").onclick = () => {
    const c = {
      id: uid(),
      groom:"", bride:"",
      date:"", time:"",
      venue:"", maps:"",
      wa:"", wm:"¬© R-E-M Digital Invitation",
      tag:""
    };
    const list = loadCustomers();
    list.unshift(c);
    saveCustomers(list);
    renderSelect(list, c.id);
    fillForm(c);
    renderLinks(c);
  };

  $("btnDelete").onclick = () => {
    const id = $("customerSelect").value;
    if(!id) return;
    const list = loadCustomers().filter(x => x.id !== id);
    saveCustomers(list);
    renderSelect(list, list[0]?.id || "");
    if(list[0]) fillForm(list[0]);
    renderLinks(list[0] || currentForm());
  };

  $("btnOpen").onclick = () => {
    const base = $("baseUrl").value.trim() || getBaseUrlAuto();
    const payload = makeConfigPayload(currentForm());
    window.open(`${base}invite.html?v=4&c=${encodeURIComponent(payload)}`, "_blank");
  };

  $("btnExport").onclick = () => {
    const data = JSON.stringify(loadCustomers(), null, 2);
    const blob = new Blob([data], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "rem_customers_backup.json";
    a.click();
  };

  $("importFile").onchange = async (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const text = await file.text();
    try {
      const list = JSON.parse(text);
      if(Array.isArray(list)){
        saveCustomers(list);
        renderSelect(list, list[0]?.id || "");
        if(list[0]) fillForm(list[0]);
        renderLinks(list[0] || currentForm());
      }
    } catch {}
  };
  // =========================
  // KOD ADMIN SEDIA ADA
  // =========================
  const list = loadCustomers();
  ...
  $("importFile").onchange = async (e) => { ... };

  // =========================
  // üîê KOD PASSWORD ADMIN (TAMBAH DI SINI)
  // =========================
  const LS_PASS = "REM_ADMIN_PASS_V1";
  const LS_OK   = "REM_ADMIN_OK_V1";

  if(!localStorage.getItem(LS_PASS)){
    localStorage.setItem(LS_PASS, "123456");
  }

  function requireLogin(){
    const pass = prompt("Admin Password:");
    if(pass !== localStorage.getItem(LS_PASS)){
      alert("Password salah");
      location.href = "./index.html";
      return false;
    }
    localStorage.setItem(LS_OK, "1");
    return true;
  }

  if(localStorage.getItem(LS_OK) !== "1"){
    requireLogin();
  }

  function changeAdminPassword(){
    const oldP = prompt("Password lama:");
    if(oldP !== localStorage.getItem(LS_PASS)){
      alert("Password lama salah");
      return;
    }
    const newP = prompt("Password baru (min 6):");
    if(!newP || newP.length < 6){
      alert("Password baru terlalu pendek");
      return;
    }
    localStorage.setItem(LS_PASS, newP);
    alert("‚úÖ Password berjaya ditukar");
  }

  function adminLogout(){
    localStorage.removeItem(LS_OK);
    alert("Logout");
    location.href = "./index.html";
  }

  window.changeAdminPassword = changeAdminPassword;
  window.adminLogout = adminLogout;

</script>
</body>
</html>
</script>
</body>
</html>
